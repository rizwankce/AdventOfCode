import Cocoa

let input = #"""
                    /--------------------------------------------------\                                        /----------------\
          /---------+--------------------------------------------------+-------------\                          |                |/-------------\
          |   /-----+---------------------------------\                |          /--+--------------------------+-------\        ||             |
          |   |     |                                 |        /-------+----------+--+--------------------------+-------+---\    ||             |
          |   |     |              /------------------+--------+-------+\         |  |                          |       |   |    ||             |
          |   |     |    /---------+------------------+--------+--\    ||         |  |                    /-----+-------+---+----++-------------+---\
          |   |     |    |         |                  |        |  |    ||         |  |                    |     |       |   |    ||             |   |
        /-+---+-----+----+---\     |                  |        |  |    ||         |/-+--------------------+-----+-------+---+----++-------------+\  |
        | |   |     |    |   |     |   /--------------+--------+--+----++---------++-+--------------------+-----+------\|   |    ||             ||  |
        | |/--+-----+----+---+-----+---+--------------+--------+--+----++\        || |                    |     |      ||   |    ||             ||  |
        | ||  |     |    |   |     |   |              |        |  |   /+++--------++-+--------------------+\    |      ||   |    ||             ||  |
        | ||  |   /-+----+---+-----+---+--------------+--\     |  |   ||||        || |  /-----------------++\   |      ||   |    ||             ||  |
        | || /+---+-+--\ |   |     |   |              |  |     |  |   ||||        || |  |                 |||   |      ||   |    ||             ||  |
      /-+-++-++---+-+--+-+---+-----+---+--------------+--+-----+--+---++++--------++-+--+----------\      |||   |      ||   |    ||             ||  |
      | | || ||   | |  | |   |     |/--+--------------+\ |     |  |   ||||        || |  |          |      |||   |      ||   |    |\-------------/|  |
      | | || ||   | |  | |   |/----++--+--------------++-+-----+--+---++++--------++-+--+----------+---\  |||   |      ||   |    |               |  |
      | | || ||  /+-+--+-+---++----++--+--------------++-+-----+--+---++++--------++-+--+----------+---+--+++\  |      ||   |    |               |  |
      | | || ||  || |  | |   ||    ||  |       /------++-+-----+--+---++++--------++-+--+----------+---+--++++--+---\  ||   |    |               |  |
      | | || ||  || |  | |   ||    ||  |       |      || |     |  |   ||||        || |  |          |   |  ||||  |   |  ||   |    |               |  |
      | | || ||  || |  | |   ||    || /+-------+------++-+-----+--+---++++---->---++-+--+----------+---+--++++--+---+--++---+-\  |               |  |
      | | || ||  || |  | |   ||    || ||       |      || |     |  |   ||||        || |  |          |   |  ||||  |   |  ||   | |  |               |  |
      | | || ||  || |  | |   ||    || ||       |      || |     |  |   ||||        || |  |          |   |  ||||  |   |  ||   | |  |               |  |
      | | ||/++--++-+--+-+---++\   || ||       |      || |     |  |   ||||        || |  |          |   |  ||||  |   |  ||   | |  |               |  |
     /+-+-+++++\ || |  | |   |||   || ||       |      || |/----+--+---++++--------++-+--+----------+---+--++++--+---+--++---+-+-\|               |  |
 /---++-+-++++++-++-+--+-+---+++---++-++----->-+------++-++----+--+---++++--------++\|  |    /-----+---+--++++--+---+--++---+-+-++---------------+\ |
 |   || | |||||| || \--+-+---+++---++-++-------+------++-++----+--+---+/||        |\++--+----+-----+---+--++++--+---+--++---+-+-++---------------/| |
 |   || | |||||| ||    | |   |||   || ||     /-+------++-++----+--+---+-++--------+-++--+----+-----+---+--++++--+---+--++--\|/+-++------------\   | |
 |   || | |||||| ||    | |   |||   || ||     | |  /---++-++----+-\|  /+-++--------+-++--+----+-----+-\ |  ||||  |   |  ||  |||| ||            |   | |
 |   || | |||||| ||    | |   |||   || ||     | |  |   || ||   /+-++--++-++--\     | ||/-+----+-----+-+-+--++++--+---+--++--++++-++--\         |   | |
 |   |\-+-++++++-++----+-+---+++---++-++-----+-+--+---++-++---++-++--++-++--+-----+-+++-+----+-----/ | |  ||||  |   |  ||  |||| ||  |         |   | |
 |   |  | |||||| ||    | |   |||   || ||     | |  |   || ||   || ||  || ||  |     | ||| |    |       | |  ||||  |   | /++--++++-++--+--------\|   | |
 |   |  | |||||| ||    | |   |||   || ||  /--+-+--+---++-++---++-++--++-++--+-----+-+++-+----+--\    | |  ||||  |   | |||  |||| ||  |        ||   | |
 |   |  | |\++++-++----+-+---+++---++-++--+--+-+--+---++-++---++-++--++-+/  |     | ||| |  /-+--+----+-+--++++--+---+-+++--++++-++--+----\   ||   | |
 |   |  | \-++++-++----+-+---+++---++-++--+--+-+--+---++-++---++-++--++-+---+-----+-+/| |  | |  |/---+-+--++++--+---+-+++--++++-++-\|    |   ||   | |
 |   |  |   |||| \+----+-+---+++---++-++--+--+-+--+---++-++---++-++--++-+---+-----+-+-+-+--+-+--++---+-+--+++/  |   | |||  |||| || ||    |   ||   | |
 |   |  |   ||||  |    | |   |||   || ||  |  | |  |   || ||   || ||  || |   |     | | | |  | |  ||   | |  |||   |   | |||  |||| || ||    |   ||   | |
 |   |  |   ||||  |    | |   |||  /++-++--+--+-+--+---++-++---++-++--++-+---+----\| | | |  | |  ||   | |  |||   |   | |||  |||| || ||    |   ||   | |
 |   |  \---++++--+----+-+---/||  ||| ||  |  | |  |   || ||  /++-++--++-+\  |    || | | |  | |  ||   | |  |||   |   | |||/-++++-++-++----+---++---+-+\
 |   |      ||||  |    | |    ||  ||| ||  |  | |  |   || ||  ||| ||  || ||  |    || | | |  | |  ||   | | /+++---+---+\|||| |||| || ||    |   ||   | ||
 |   |      ||||  |   /+-+----++--+++-++--+--+-+--+---++-++\ ||| ||  || ||  | /--++-+-+-+-\|/+--++---+-+-++++---+---++++++-++++-++-++----+---++--\| ||
 |   \------+++/  |   || |    ||  ||| ||/-+--+-+--+---++-+++-+++-++--++-++--+-+--++-+-+-+-++++--++---+-+-++++-\ |   |||||| |||| || ||    |   ||  || ||
 |          |||   |   || |    ||  ||| ||| |  | |  |   || |||/+++-++--++-++--+-+--++-+-+-+-++++->++---+-+-++++-+-+---++++++-++++-++-++--\ |   ||  || ||
 |          |||   |   || |    ||  ||| ||| \--+-+--+---++-+++++++-++--++-++--+-+--++-+-+-+-++++--/|   | | |||| | |   |||||| |||| || ||  | |   ||  || ||
 |          |||  /+---++-+----++--+++-+++----+-+--+---++-+++++++-++--++-++--+-+--++-+-+-+-++++--\|   | | |||| | |   |||||| |||| || ||  | |   ||  || ||
 |          |||  ||   || |    ||  ||| |||    | |  \---++-+++++++-/|  || ||  | |  || | | | |\++--++---+-+-++++-+-+---++++++-++++-++-++--+-/   ||  || ||
 |          |||  ||   || |    ||  ||v |||    | |      || |||||||  |  || ||  | |  || | | |/+-++--++---+-+-++++-+-+---++++++-++++-++-++-\|     ||  || ||
 |          |||/-++---++-+----++--+++-+++----+-+------++-+++++++--+--++-++--+-+--++-+-+-+++-++--++---+-+-++++-+-+--\|||||| ||||/++-++-++-\   ||  || ||
 |          |||| ||   || |   /++--+++-+++----+-+------++-+++++++-\|  \+-++--+-+--++-+-+-+++-++--++---/ | |||| | |  ||||||| ||||||| || || |   ||  || ||
 |          |||| ||   || |   |||  ||| \++----+-+------++-+++++++-++---+-++--+-+--++-+-+-+++-++--++-----+-++++-+-+--+++++++-+++/||| || || |   ||  || ||
 |          |||| ||   || |   |||  |||  ||    | |      || ||||||| ||   | ||  | |  || | | ||| ||  ||     | |||| | |  ||||||| ||| ||| || || |   ||  || ||
 |          |||| || /-++-+---+++--+++--++----+-+------++-+++++++-++---+-++--+-+--++-+-+-+++-++--++-----+-++++-+-+-\||||||| ||| ||| || || |   ||  || ||
 |          |||| || | || |   |||  |||  ||    |/+------++-+++++++-++---+-++--+\|  || | | ||| ||/-++-----+-++++-+-+-++++++++-+++-+++\|| || |   ||  || ||
 |  /-------++++-++-+-++-+---+++--+++--++----+++------++-+++++++-++-\ | ||  |||  || | | ||| ||| ||     | |||| | | |||||||| ||| |||||| || |   ||  || ||
 |  |       |||| || | || |   |||  |||  ||    |||      || ||||||| || | | ||  |||  || | | ||| ||| ||     | |||| | | |||||||| ||| |||||| || |   ||  || ||
 |  |       |||| || | || |   |||  |||  ||    |||      || ||||||| || | | ||  |||  || | | ||| ||| ||     | |||| | |/++++++++-+++-++++++-++-+-\ ||  || ||
 |  |       |||| || | || |   |||  |||  ||    |||      || ||||||| || | ^ ||  |||  || | | ||| ||| ||     | |||| | |||||||||| ||| |||||| || | | ||  || ||
 |  |       |||| || | ||/+---+++--+++--++----+++\     || ||||||| || | | ||  |||  || | | |^| ||| |\-----+-++++-+-++++++++++-+++-++++/| || | | ||  || ||
 |  |       |||| || | ||||   |||  ||\--++----++++-----+/ ||||||| || | | ||  |||  || | | ||| ||| |      | |||| | |||||||||| ||| |||| | || | | ||  || ||
 |  |  /----++++-++-+-++++---+++--++---++----++++-----+--+++++++-++-+-+-++--+++\ || | | ||| ||| |      | |||| | |||||||||\-+++-++++-+-++-+-+-++--++-+/
 |  |  |    |||| || | ||||   |||  ||   ||    ||||     |  ||||||| || | | ||  |||| || | \-+++-+++-+------+-++++-+-+++++++++--+++-++++-/ || | | ||  || |
 |  |  |    |||| || | ||||   |||  ||   ||    ||||     |  ||||||| || |/+-++--++++-++-+---+++-+++-+------+-++++-+-+++++++++--+++\||||   || | | ||  || |
 |  |  |    |||| |\-+-++++---+++--++---++----++++-----+--/|||||| || ||| ||  |||| || |   ||| ||| |      | |||| | |||||||||  |^||||||   || | | ||  || |
 |  |  |    |||| |  | ||||   |||/-++---++----++++-----+---++++++-++-+++-++--++++-++-+---+++-+++-+----\ | |||| | |||||||||  ||||||||   || | | ||  || |
 |  |  |    |||| |  | ||||   |||| ||   ||    ||||     |   |||||| || ||| ||  |||| || |   ||| \++-+----+-+-++++-+-+++++++++--++++++++---++-+-+-++--/| |
 |  |  |  /-++++-+--+-++++---++++-++---++----++++-----+---++++++-++-+++-++-\|||| || |   |||  || |    | | |||| | |||||||||  ||||||||   || | | ||   | |
 |  |  |  | |||| |  | ||||   |||| ||   ||    ||||     |   |||||| || ||| || ||||| || |   |||  || |    | | |||| | \++++++++--++++++/|   || | | ||   | |
 |  |  |  | |||| |  | ||||   |||| ||   ||    ||||     |  /++++++-++-+++-++-+++++-++-+---+++--++\|    | | |||| |  ||||||||  |||||| |   || | | ||   | |
 |  |  |  | |||| |  | ||||   |||| ||   ||    ||||     |  |||||||/++-+++-++-+++++-++-+---+++--++++----+-+\|||| |  ||||||||  |||||| |   || | | ||   | |
 |  |  | /+-++++-+--+-++++---++++-++---++----++++-----+--++++++++++-+++-++-+++++-++-+-\ |||  ||||    | |||||| |  ||||||||  |||||| |   || | | ||   | |
 |  |  | || |||| |  | ||||   |||| ||   \+----++++-----+--++++++++++-+++-++-+++++-++-+-+-+++--++++----+-++++++-+--++++++/|  |||||| |   || | | ||   | |
 |  |  | || |\++-+--+-+/||   |||| ||    |    ||||     |  |||||||||| ||\-++-+++++-++-+-+-+++--++++----+-++++/| |  |||||| |  |||||| |   || | | ||   | |
 |  |  | || | || |  | | ||   |||| ||    |    ||||     |  |||||\++++-++--++-+/||| || | |/+++--++++----+-++++-+-+--++++++-+--++++++-+-\ || | | ||   | |
 |/-+--+-++-+-++-+--+-+\||   |||| ||    |    ||||     |  ||||| |||| ||  || | ||| || | |||||  ||||    | |||\-+-+--++++++-+--++++++-+-+-++-+-+-++---+-/
 || |  | || | || |  | ||||   |||| ||    |    ||||     |  ||||| |||| ||  || | ||| || | |||||  ||||    | |||/-+-+--++++++-+--++++++-+-+-++-+\| ||   |
 || |  | || | || |  | ||||   |||| ||    | /--++++-----+--+++++-++++-++--++-+-+++-++-+-+++++--++++----+-++++-+-+--++++++-+--++++++-+-+-++-+++-++---+--\
 || |  | || | || |  | \+++---++++-++----+-+--++++-----+--++/|| |||| ||  || | |\+-++-+-++++/  ||||    | |||| | |  |||||| |  |||||| | | || ||| ||   |  |
 || |  | || | || |  |  |||   |||| ||    | |  ||||   /-+--++-++-++++-++--++-+-+-+-++-+-++++---++++----+-++++-+-+--++++++-+-\|||||| | | || ||| ||   |  |
 || |  | || \-++-+--+--+++---++/| ||    | |  ||||   | |  || || |||| ||  || | | | || | ||||  /++++----+-++++-+-+--++++++-+-+++++++-+-+-++\||| ||   |  |
 || |  | ||   || |  |  |||   || | |\----+-+--++++---+-+--++-++-++++-++--/| | | | ||/+-++++--+++++----+-++++-+-+--++++++-+-+++++++\| | |||||| ||   |  |
 || |  | ||   || |  |  |||   || | |     | |  ||||   | |  || || |||| ||   | | | | |||| ||||  |||||    | |||| | |  |||||| | ||||||||| | |||||| ||   |  |
 || |  | ||   || |  \--+++---++-+-+-----+-+--++++---+-+--++-++-++++-++---+-+-+-+-++++-++++--+++++----+-++++-+-+--+/|||| | ||||||||| | |||||| ||   |  |
 || |  | ||  /++-+-----+++\  || | \-----+-+--++++---+-+--++-++-++++-++---+-+-+-+-/||| ||||  |||||    | |||| | |  | |||| | ||||||||| | |||||| ||   |  |
 || |  | ||  |||/+-----++++--++-+----\  | |  ||||   | |  || || |||| ||   | | | |  ||| ||||  |||||    | |||| | |  | |||\-+-+++++++++-+-++++++-/|   |  |
 || |  | ||  ||\++-----++++--++-+----+--+-+--++++---+-+--++-++-++++-++---+-+-+-+--+++-++++--+++++----+-++++-+-+--+-/||  | ||||||||| | ||||||  |   |  |
 || |  ^ ||  || ||     |||| /++-+----+--+-+\ ||||   | |  || || |||| ||   | | | |  ||| ||||  ||\++----+-++++-+-+--+--++--+-++++++++/ | ||||||  |   |  |
 || |  | ||  || ||     |||| ||| |    |  | || ||||   \-+--++-++-++++-++---+-+-+-+--+++-++++--++-++----+-++++-+-+--+--++--+-/|||||||  | ||||||  |   |  |
 || |  | ||/-++-++-----++++\||| |    |  | || ||||     |  || || |||| |\---+-+-+-+--+++-++++--++-++----+-++++-+-+--+--++--+--+++/|||  | ||||||  |   |  |
 || |  | ||| |\-++-----++++++++-+----+<-+-++-++++-----/  || || |||| |    | | | |  ||| ||||  || ||    | ||\+-+-+--+--+/  |  ||| |||  | v|||||  |   |  |
 \+-+--+-+++-+--++-----++++++++-+----+--+-++-++++--------++-++-++++-+----+-+-+-+--++/ ||||  || ||/---+-++-+-+-+--+--+---+--+++-+++--+-++++++\ |   |  |
  | |  | ||| |  ||     |||||||| |    |  | || ||||        || || |||| |    | | | |  |\--++++--++-+++---+-++-+-+-+--+--+---+--+++-++/  | ||||||| |   |  |
  | | /+-+++-+--++-----++++++++-+----+--+-++-++++----\   || || \+++-+----+-+-+-+--+---++++--++-+++---+-++-+-+-+--+--+---+--+/| ||   | ||||||| |   |  |
  | | || |||/+--++-----++++++++-+----+--+-++\||||    |   || \+--+++-+----+-+-+-+--+---++++--++-+++---+-++-+-+-+--+--+---+--+-+-++---+-+/||||| |   |  |
/-+-+-++-+++++--++-----++++++++-+----+--+-+++++++----+---++-\|  \++-+----+-+-+-+--+---++++--++-+++---+-+/ | | |  |  |   |  | | ||   | | ||||| |   |  |
| | | || |||||  ||     |||||||| |    |  | |||||||    |   || ||   || |    | | | |  \---++++--++-+++---+-+--+-+-+--+--+---/  | | ||   | | ||||| |   |  |
| | | || |||||  ||     |||||||| |    |  | |||||||    |   || ||   ||/+----+-+-+-+------++++-\|\-+++---+-+--+-+-+--+--+------+-+-++---+-+-+++++-+---/  |
| | | || |||||  ||     |||||||| |    |  | |||||||/---+---++-++---++++----+-+-+-+------++++-++--+++---+-+--+-+-+--+--+------+-+-++->-+-+-+++++-+\     |
| | | || |||||  ||     |||||||| |    |  | ||||||||   |   || ||   ||||    |/+-+-+------++++-++--+++---+-+--+-+-+--+--+------+-+-++---+-+\||||| ||     |
| | | || |||||/-++-----++++++++-+----+--+-++++++++---+---++-++---++++-\  ||| |/+------++++-++--+++---+-+--+-+-+--+--+------+-+-++---+-+++++++-++----\|
| | | || |||||| ||     |||||||| |    |  | ||||||||   |   || ||   |||| |  ||| |||      |||| ||  |||   | |  | | |  |  |      | | ||   | ||||||| ||    ||
| | \-++-++++++-++-----++++++++-+----+--+-++++++++---+---++-++---+++/ |  ||| |||      |||| ||  |||   | |  | | |  |  |      | | ||   | ||||||| ||    ||
| |   || |||||| ||     |||||||\-+----+--+-++++++++---+---++-++---+++--+--+++-+++------++++-++--+++---+-/  | | |  |  |      | | ||   | ||||||| ||    ||
| |   || |||||| ||     |||||||  |    |  | \+++++++---+---++-++---+++--+--+++-+++------++++-++--+++---+----+-+-+--+--+------+-+-++---+-+++++++-++----+/
| |   || |||||| ||     |||||||  |    |  |  |||||||   |   || ||   |||  |  ||| |||      |||| ||  |||   |    | | |  |  |      | | ||   | ||||||| ||    |
| |   || |||||| ||     |||||||  |    |  |  |||||||   |   || ||   |||  |  ||| ||| /----++++-++--+++---+----+-+-+--+--+------+-+-++--\| ||||||| ||    |
| |   || |||||| ||     |||||||  |    |  |  |||\+++---+---++-++---+++--+--+++-/|| |    |||| ||  |||   |    | | |  |  |      | | ||  || ||||||| ||    |
| |   || |||||| ||     |||||||  |    |  |  ||| |||   |   |\-++---+++--+--+++--++-+----++++-++--+++---+----+-+-+--+--+------+-+-+/  || ||||||| ||    |
| |   || |||||| ||     |||||||  |    |  |  ||| |||   |   |  ||   |||  |  |||  || |    |||| ||  |||  /+----+-+-+--+--+------+-+-+--\|| ||||||| ||    |
| |   || |||||| ||     |||||||  |    |  |  ||| |||   |   \--++---+++--+--+++--++-+----++++-++--/||  ||    | | |  |  |  /---+-+-+--+++-+++++++-++\   |
| |   \+-++++++-++-----+++++++--+----+--+--+++-+++---/      ||   |||  |/-+++--++-+----++++-++---++-\||    | | |  |  |  |   | | \--+++-+++/||| |||   |
| |    | |||||| ||     |||||||  |    |  |  ||| |||          ||   |||  || |||  || |    v||| ||   || |||   /+-+-+--+--+--+---+-+\   ||| ||| ||| |||   |
| |    | |||||| ||     |||||||  |    |  \--+++-+++----------++---+++--++-+++--++-+----++++-++---++-+++---++-+-/  |  |  |   | ||   ||| ||| ||| |||   |
| \----+-++++++-++-----/|\++++--+----+-----+++-+++----------++---+/|  || |||  || |    ||||/++---++-+++---++-+---\|  |  |   | ||   ||| ||| ||| |||   |
|      | |||||| \+------+-++++--+----/     ||| |||          ||   | |  || |||  || |    |||||||   || |||   || |   ||  |  |   | ||   ||| ||| ||| |||   |
|      | ||||||  |      | ||||  |          ||| |||          ||   | |  || |||  || |    |||||||   || |||   || |   ||  |  |   | ||   ||| ||| ||| |||   |
|      | ||||||  |    /-+-++++--+------\   ||| ||v          ||   | |  || |||  || |    |||||||   |\-+++---++-+---++--+--+---+-++---+++-+++-++/ |||   |
|      | ||||||  |    | | ||||  |      |   ||| |||          ||   | |  || |||  || |    ||\++++---+--+++---++-/   ||  |  |   | ||   ||| ||| ||  |||   |
|      | ||||||  |    | | ||||  |      |   ||| |||          ||   | |  || |||  \+-+----++-++++---+--+++---++-----++--+--+---+-++---+++-+++-++--+++---/
|      \-++++++--+----+-+-++++--+------+---+++-+++----------++---+-+--++-+++---/ |    || ||||   |  |||   ||     ||  |  |   | ||   ||| ||| ||  |||
|        ||||||  |    | | ||||  |      |   ||\-+++----------++---+-+--++-+++-----+----++-++++---+--+++---++-----++--+--+---/ \+---+++-+++-++--/||
|     /--++++++--+----+-+-++++--+------+---++--+++\         |\---+-+--++-/||     |    || ||||   |  |||   \+-----++--+--+------/   ||| ||| ||   ||
|     |  ||||||  |    | | ||||  |      |   ||  ||||         |    | |  ||  ||     |    || ||||   |  |||    |     ||  |  |          ||| ||| ||   ||
|     |  \+++++--+----+-+-++++--+------+---++--++++---------+----+-+--++--++-----+----/| ||||   |  |||    \-----++--+--+----------+++-+++-/|   ||
|     |/--+++++--+----+-+-++++--+------+---++-\\+++---------+----+-+--++--++-----+-----+-++++---+--+++----------++--/  |          ||| |||  |   ||
|     ||  |||||  |    | | ||||  \------+---++-+-+++---------+----+-+--++--++-----+-----+-++++---+--++/          ||     |          ||| |||  |   ||
|     ||  |||||  |    | | ||||         |   || | |||         |    | |  ||  ||     |     | ||||   |  ||           ||     |          ||| |||  |   ||
|     ||  |||||  |    | | ||||         |   || | |||         |    | |  ||  ||     |     | ||||   |  ||/----------++-----+------\   ||| |||  |   ||
|     ||  |||||  |    | | ||||         |   || | |||         |    | \--++--++-----+-----+-++/|   |  |||          ||     |      |   ||| |||  |   ||
|/----++--+++++--+----+-+-++++---------+---++-+-+++---------+----+----++--++-----+\    | \+-+---+--+++----------++-----+------+---+++-/||  |   ||
||    ||  |||||  |    \-+-++++---------/   || | |||         |    |    ||  ||     ||    |  | |   |  |||          ||     |      |   |||  ||  |   ||
||    ||  |||||  |      | ||||             || | |||         |    |    ||  ||     ||    |  | |   |  |||          ||     \------+---+++--++--+---+/
||    ||  |||||  |      | ||\+-------------/| | |||         |    |    ||  || /---++----+--+-+---+--+++---\      ||            |   |||  ||  |   |
||    |\--+++++--+------+-++-+--------------+-/ |||         |    |    ||  || |   ||    |  | |   |  |||   |      ||            |   |||  ||  |   |
||    |   |||||  |      | || |  /-----------+\  |\+---------+----+----++--++-+---++----+--+-+---+--+++---+------++------------+---+++--++--+---/
||    |   |\+++--+------+-+/ |  |   /-------++--+-+--\      |    |    ||  || |   ||    |  | |   |  |||   |      ||            |   |||  ||  |
||    |  /+-+++--+------+-+--+--+---+-------++--+-+--+------+----+----++--++-+---++----+--+-+---+--+++\  |      ||            |   |||  ||  |
||    |  || |||  |      | |  |  |   |       ||  | |  |      |    |    ||  || |   ||    |  | |   |  ||\+--+------++------------/   |||  |^  |
||    |  || |||  |      | |  \--+---+-------++--+-+--+------+----/    ||  || |   ||    |  | |   |  || |  |      ||                |||  ||  |
||    |  || |||  |      | |     |   |       ||  | |  |      |         ||  || |   ||    |  | |   |  || |  |      ||                |||  ||  |
||    \--++-+++--+------+-+-----+---+-------++--+-/  |      |         ||  || |   ||    \--+-+---+--++-+--+------++----------------++/  ||  |
||       || |||  |      \-+-----+---+-------++--/    |      |         ||  || |   ||       | |   |  || |  |      |\----------------++---++->/
||       || ||\--+--------+-----+---+-------++-------+------+-<-------/|  || |   ||       | \---+--++-+--+------+-----------------++---+/
||       |\-++---+--------+-----+---+-------++-------+------+----------+--+/ |   ||       |     |  || |  |      |                 ||   |
\+-------+--++>--+--------+-----+---+-------++-------+------/          |  |  \---++-------+-----+--++-+--/      |                 ||   |
 |       |  ||   \--------+-----+---+-------++-------+-----------------+--+------++-------+-----/  || |         |                 ||   |
 |       |  \+------------+-----+---+-------/|       |                 |  \------++-------+--------++-+---------+-----------------++---/
 |       |   \------------/     \---+--------/       |                 |         \+-------+--------++-+---------+-----------------+/
 |       |                          |                |                 \----------+-------+--------/| |         |                 |
 \-------+--------------------------+----------------+----------------------------/       |         \-+---------+-----------------/
         \--------------------------+----------------+------------------------------------+-----------/         |
                                    \----------------/                                    \---------------------/
"""#.components(separatedBy: .newlines)

//print(input)

struct Point: CustomStringConvertible, Equatable, Hashable {
    var x: Int
    var y: Int

    var description: String {
        get {
            return "(X:\(self.x) Y:\(self.y))"
        }
    }

    func move(_ direction: Direction) -> Point {
        switch direction {
        case .left: return Point.init(x: self.x, y: self.y-1)
        case .right: return Point.init(x: self.x, y: self.y+1)
        case .up: return Point.init(x: self.x-1, y: self.y)
        case .down: return Point.init(x: self.x+1, y: self.y)
        }
    }
}

enum Direction: Character, CaseIterable {
    case left = "<"
    case right = ">"
    case up = "^"
    case down = "v"
}

extension Direction {
    func replacingChar() -> Character {
        switch self {
        case .left: return "-"
        case .right: return "-"
        case .up: return "|"
        case .down: return "|"
        }
    }

    func turn(_ corner: Character) -> Direction {
        var result: Direction
        switch self {
        case .left: result = corner == "/" ? .down : .up
        case .right: result = corner == "/" ? .up : .down
        case .up: result = corner == "/" ? .right: .left
        case .down: result = corner == "/" ? .left: .right
        }
        return result
    }

    func turn(_ dir: Int) -> Direction {
        if dir == 0 {
            switch self {
            case .left: return .down
            case .right: return .up
            case .up: return .left
            case .down: return .right
            }
        }
        else if dir == 1 {
            switch self {
            case .left: return .left
            case .right: return .right
            case .up: return .up
            case .down: return .down
            }
        }
        else if dir == 2 {
            switch self {
            case .left: return .up
            case .right: return .down
            case .up: return .right
            case .down: return .left
            }
        }

        assert(false)
        return .right
    }
}

class Cart: CustomStringConvertible {
    var point: Point
    var direction: Direction
    var move: Int = -1

    init(_ point: Point, _ direction: Direction) {
        self.point = point
        self.direction = direction
    }

    var description: String {
        "\(point) \(direction.rawValue)"
    }

    func turnAtIntersection() -> Direction {
        move += 1
        if move >= 3 {
            move -= 3
        }
        return direction.turn(move)
    }
}

struct Grid {
    typealias Cell = [Point: Character]

    var grid: Cell = [:]
    var rowCount: Int = 0
    var colCount: Int = 0
    var carts: [Cart] = []

    let corners: [Character] = ["/","\\"].map { Character($0) }

    init(_ input: [String]) {
        input.enumerated().forEach { (i,line) in
            line.enumerated().forEach { (j,char) in
                let p = Point.init(x: i, y: j)
                if let dir = Direction.init(rawValue: char) {
                    carts.append(Cart.init(p, dir))
                    grid[p] = dir.replacingChar()
                }
                else {
                    grid[p] = char
                }
            }
        }
        self.rowCount = grid.keys.map { $0.x }.max()!
        self.colCount = grid.keys.map { $0.y }.max()!
    }

    func debugPrint() {
        print("grid start")
        print("rc", separator: "", terminator: " ")
        (0 ... colCount).forEach {
            print($0, separator: " ", terminator: " ")
        }
        print("\n\n")
        for r in (0 ... rowCount) {
            print(r, separator: " ", terminator: "  ")
            for c in (0 ... colCount) {
                let p = Point(x: r, y: c)
                let v = carts.map { $0.point }.contains(p) ? carts.filter { $0.point == p }.first!.direction.rawValue : grid[p, default: " "]
                print(v, separator: " ", terminator: " ")
            }
            print("\n")
        }
        print("grid end")
    }

    mutating func tick(_ continueAfterCrash: Bool) -> Point? {
        for index in 0 ..< carts.count {
            let cart = carts[index]
            let new = cart.point.move(cart.direction)

            if grid[new] == "-" || grid[new] == "|" {
                cart.point = new
            }
            else if corners.contains(grid[new, default: " "]) {
                cart.point = new
                cart.direction = cart.direction.turn(grid[new]!)
            }
            else if grid[new] == "+" {
                cart.point = new
                cart.direction = cart.turnAtIntersection()
            }
            carts[index] = cart
        }

        var points: Set<Point> = []
        var result: Point? = nil
        var crashed: [Point] = []
        carts.forEach { cart in
            if !points.insert(cart.point).inserted {
                if continueAfterCrash {
                    crashed.append(cart.point)
                }
                else {
                    result = cart.point
                }
            }
        }

        if !crashed.isEmpty {
            carts = carts.filter({ !crashed.contains($0.point) })

            if carts.count == 1 {
                result = carts.first!.point
            }
        }

        return result
    }
}

func partOne() -> String {
    var grid = Grid.init(input)
    var result: Point? = nil

    while result == nil {
        result = grid.tick(false)
    }

    return "\(result!.y),\(result!.x)"
}

func partTwo() -> String {
    var grid = Grid.init(input)
    var result: Point? = nil

    while result == nil {
        result = grid.tick(true)
    }

    return "\(result!.y),\(result!.x)"
}

print("Part One answer is: \(partOne())")
print("Part Two answer is: \(partTwo())")
